jQuery(document).ready(function(a){function b(){var b="ws";return"https:"===a(location).attr("protocol")&&(b="wss"),b}function c(a){if(a.loading)return a.text;var b='<div class="clearfix"><div class="col-sm-6">'+a.name+"</div></div>";return b}function d(b){return a("#newUser-integra").val(b.devName),a("#newUser-integraCode").val(""),a("#newUser-integraCode").prop("placeholder",b.hasCode?"*****":a("#trans-integracode-placeholder").val()),b.name||b.text}function e(b){return a(b).filter(function(b,c){return 0===a('tr[data-idintegra][data-iduser="'+c.id+'"]').length})}function f(a,b){a.data("username",b.userName),a.data("name","["+b.idx+"] "+b.integraName),a.data("newname",b.integraName),a.data("iduser",b.userId),a.data("idx",b.idx),a.data("idobject",b.idObject),a.data("integrauserid",b.id),a.attr("data-username",b.userName),a.attr("data-name","["+b.idx+"] "+b.integraName),a.attr("data-newname",b.integraName),a.attr("data-iduser",b.userId),a.attr("data-idx",b.idx),a.attr("data-idobject",b.idObject),a.attr("data-integrauserid",b.id)}var g=a("#manageUserControl").length>0;a('[data-toggle2="tooltip"]').tooltip({container:"body"}),a.getJSON("/websocket/options",function(c){var d,e=a(location).attr("port");d="81x"===e?b()+"://"+c.mapoptions.uri+"/integrumservices/integrasocket/":b()+"://"+a(location).attr("host")+"/integrum/integrumservices/integrasocket/",CR.init({uri:d,token:c.token},WS)});var h=a("#structure-integraId").val(),i=a("#structure-integrausername").val();window.noUserDescr=a("#structure-noUserDescr").val(),a(".userIdNew").select2({minimumInputLength:1,placeholder:a("#trans-userIdNew-placeholder").val(),allowClear:!0,ajax:{url:function(a){return"/users/findbynamenew/"+a.term},dataType:"json",delay:250,processResults:function(a){return{results:e(a)}},cache:!0},escapeMarkup:function(a){return a},templateResult:c,templateSelection:d});var j=a("#addUserDialog");if(j.length>0){var k=new IntegraUserRights(j.find("#integraUserRights"));j.on("show.bs.modal",function(){var b=a("input[name=_token]").val();j.find("#confirmUserAdd").prop("disabled","disabled"),k.prepareIntegra(h,void 0,void 0,void 0,b),l=void 0,m=void 0,j.find("#newUser-integra").trigger("change"),k.activateSave()});var l=void 0,m=void 0;j.find("#newUser-integra, #newUser-integraCode, .userIdNew").on("change",function(){var b=j.find("#newUser-integra").val(),c=j.find("#newUser-integraCode").val();a("#newUser").is(":hidden")?(l=""!=b,l&=""!=c):l=""!=j.find("#newUser").select2("val"),l&&m?j.find("#confirmUserAdd").prop("disabled",!1):j.find("#confirmUserAdd").prop("disabled",!0)}),j.on("edit-user-activate-save",function(a,b){m=b,l&&m?j.find("#confirmUserAdd").prop("disabled",!1):j.find("#confirmUserAdd").prop("disabled",!0)}),a("#switch-new-user-integra").on("click",function(){a("#userNew-integra").show(),a("#newUser").addClass("disabled"),a("#userNew-integra").is(":visible")?a("#newUser").focus():a("#newUser-integra").focus()}),a("#switch-new-user-integrum").on("click",function(){a("#userNew-integra").hide(),a("#userNew-integrum").removeClass("disabled"),a("#userNew-integra").is(":visible")?a("#newUser").focus():a("#newUser-integra").focus()})}if(g){var n=new ManageUser;n.on("mu-user-changed",function(b,c){var d=!1;""===c.userName||null===c.userName?(a("#userIcon-"+c.id).attr("title","["+c.idx+"]"),d=a("#userIcon-"+c.id+" .icon-integrum:visible").length>0,a("#userIcon-"+c.id+" .icon-integrum").hide(),a("#userIcon-"+c.id+" .icon-integra").show(),a("#userdetail-"+c.id).hide()):(a("#userIcon-"+c.id).attr("title",i+": ["+c.idx+"] "+c.integraName),a("#userIcon-"+c.id+" .icon-integrum").show(),a("#userIcon-"+c.id+" .icon-integra").hide(),a("#userdetail-"+c.id).attr("href","/users/"+c.userId+"/edit#user-3#"+h),a("#userdetail-"+c.id).show()),a("#userIcon-"+c.id).tooltip("fixTitle"),a("#userlink-"+c.id).html(c.userName||c.integraName),f(a(a("#userlink-"+c.id).closest("tr")),c),d&&a("#userlink-"+c.id).click()})}a(CR).on("cr-card-added",function(b,c){var d=a("a[data-useridx="+c.userIdx+"]"),e=d.prop("title");d.prop("title",c.cardNumber),d.attr("data-cardnumber",c.cardNumber),d.data("cardnumber",c.cardNumber);var f=d.hasClass("cardWarning");if(""===c.cardNumber?d.find(".cardAdd").show():d.find(".cardAdd").hide(),f&&e!==c.cardNumber){d.removeClass("cardWarning");var g=a('a[title="'+e+'"]');1===g.size()&&d.removeClass("cardWarning")}})});